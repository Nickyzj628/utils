// @bun
var S=(...I)=>{console.log(`${new Date().toLocaleTimeString()}`,...I)};var K=async(I,$)=>{let{maxRetries:M=5,shouldStop:W=()=>!0}=$??{};for(let z=0;z<M;z++){let H=await I(z);if(W(H))return H}throw Error(`\u8D85\u8FC7\u4E86\u6700\u5927\u5FAA\u73AF\u6B21\u6570\uFF08${M}\uFF09\u4E14\u672A\u6EE1\u8DB3\u505C\u6B62\u6267\u884C\u6761\u4EF6`)};var L=(I,$=-1)=>{let M=new Map,W=(...z)=>{let H=JSON.stringify(z),D=Date.now(),J=M.get(H);if(J&&D<J.expiresAt)return J.value;let G=$===-1?1/0:D+$*1000,X={setTtl:(Z)=>{G=D+Z*1000}},_=I.apply(X,z);if(_ instanceof Promise){let Z=_.then((C)=>{return M.set(H,{value:C,expiresAt:G}),C});return M.set(H,{value:Z,expiresAt:G}),Z}return M.set(H,{value:_,expiresAt:G}),_};return W.clear=()=>M.clear(),W.updateTtl=(z)=>{$=z;let H=Date.now(),D=H+z*1000;for(let[J,G]of M.entries())if(G.expiresAt>H)G.expiresAt=D,M.set(J,G)},W};var Q=(I)=>{return I?.constructor===Object},Y=(I)=>{return I===null||I===void 0||typeof I!=="object"&&typeof I!=="function"},U=(I)=>{return!I},V=(I)=>{return!!I},T=(I)=>{return I===null||I===void 0};var P=(I,$)=>{let M={...I};for(let W of Object.keys($)){let z=M[W],H=$[W];if(Y(z)&&Y(H)){M[W]=H;continue}if(Array.isArray(z)&&Array.isArray(H)){M[W]=z.concat(H);continue}if(Q(z)&&Q(H)){M[W]=P(z,H);continue}M[W]=H}return M},B=(I,$)=>{if(Array.isArray(I))return I.map((M)=>B(M,$));if(Q(I))return Object.keys(I).reduce((W,z)=>{let H=$(z),D=I[z];return W[H]=B(D,$),W},{});return I},F=(I,$,M)=>{let{filter:W}=M??{};if(Array.isArray(I)){let z=I.map((H,D)=>{if(Q(H))return F(H,$,M);return $(H,D)});if(W)return z.filter((H,D)=>W(H,D));return z}if(Q(I))return Object.keys(I).reduce((H,D)=>{let J=I[D],G;if(Q(J)||Array.isArray(J))G=F(J,$,M);else G=$(J,D);if(!W||W(G,D))H[D]=G;return H},{});return I};var q=(I="",$={})=>{let M=async(W,z={})=>{let H=new URL(I?`${I}${W}`:W),{params:D,parser:J,...G}=P($,z);if(Q(D))Object.entries(D).forEach(([Z,C])=>{if(T(C))return;H.searchParams.append(Z,C.toString())});if(Q(G.body))G.body=JSON.stringify(G.body),G.headers={...G.headers,"Content-Type":"application/json"};let X=await fetch(H,G);if(!X.ok){if(X.headers.get("Content-Type")?.startsWith("application/json"))throw await X.json();throw Error(X.statusText)}return await(J?.(X)??X.json())};return{get:(W,z)=>M(W,{...z,method:"GET"}),post:(W,z,H)=>M(W,{...H,method:"POST",body:z}),put:(W,z,H)=>M(W,{...H,method:"PUT",body:z}),delete:(W,z)=>M(W,{...z,method:"DELETE"})}},x=async(I)=>{try{return[null,await I]}catch($){return[$,void 0]}},w=async(I)=>{let[$,M]=await x(fetch(I,{method:"HEAD",redirect:"manual"}));if($)return I;return M.headers.get("location")||I};var d=(I,$)=>{return Math.floor(Math.random()*($-I+1))+I};import E from"sharp";var b=(I)=>{return I.replace(/_([a-zA-Z])/g,($,M)=>M.toUpperCase())},y=(I)=>{return I.replace(/([A-Z])/g,($,M)=>`_${M.toLowerCase()}`)},p=(I)=>{return I.charAt(0).toUpperCase()+I.slice(1)},n=(I)=>{return I.charAt(0).toLowerCase()+I.slice(1)},u=async(I,{quality:$=0.92}={})=>{if(!I.startsWith("http"))throw Error("\u56FE\u7247\u5730\u5740\u5FC5\u987B\u4EE5http\u6216https\u5F00\u5934");let M="",W=await q().get(I,{parser:async(D)=>{return M=D.headers.get("Content-Type")||"image/jpeg",D.arrayBuffer()}}),z=Buffer.from(W),H;if(M==="image/png")H=await E(z).png({compressionLevel:Math.round($*9)}).toBuffer();else if(M==="image/gif")H=await E(z).gif().toBuffer();else H=await E(z).jpeg({quality:$}).toBuffer();return`data:${M};base64,${H.toString("base64")}`},o=(I="",$)=>{if(!I)return"";let{maxLength:M=1/0,disableNewLineReplace:W=!1,disableWhitespaceCollapse:z=!1,omission:H="..."}=$??{},D=I;if(!W)D=D.replace(/\r?\n/g,"\\n");else D=D.replace(/\r?\n/g," ");if(!z)D=D.replace(/\s+/g," ");if(D=D.trim(),M>0&&D.length>M)return D.slice(0,M)+H;return D};var i=async(I=150)=>{return new Promise(($)=>{setTimeout($,I)})},r=(I,$=300)=>{let M=null;return(...W)=>{if(M)clearTimeout(M);M=setTimeout(()=>{I(...W)},$)}},l=(I,$=300)=>{let M=null;return function(...W){if(!M)M=setTimeout(()=>{M=null,I.apply(this,W)},$)}};export{L as withCache,x as to,S as timeLog,l as throttle,b as snakeToCamel,i as sleep,d as randomInt,P as mergeObjects,F as mapValues,B as mapKeys,K as loopUntil,V as isTruthy,Y as isPrimitive,Q as isObject,T as isNil,U as isFalsy,u as imageUrlToBase64,w as getRealURL,q as fetcher,n as decapitalize,r as debounce,o as compactStr,p as capitalize,y as camelToSnake};
