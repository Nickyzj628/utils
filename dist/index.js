// @bun
var E=(...H)=>{console.log(`${new Date().toLocaleTimeString()}`,...H)};var F=async(H,$)=>{let{maxRetries:I=5,shouldStop:W=()=>!0}=$??{};for(let M=0;M<I;M++){let D=await H(M);if(W(D))return D}throw Error(`\u8D85\u8FC7\u4E86\u6700\u5927\u5FAA\u73AF\u6B21\u6570\uFF08${I}\uFF09\u4E14\u672A\u6EE1\u8DB3\u505C\u6B62\u6267\u884C\u6761\u4EF6`)};var S=(H,$=-1)=>{let I=new Map,W=(...M)=>{let D=JSON.stringify(M),f=Date.now(),X=I.get(D);if(X&&f<X.expiresAt)return X.value;let z=$===-1?1/0:f+$*1000,Q={setTtl:(Y)=>{z=f+Y*1000}},Z=H.apply(Q,M);if(Z instanceof Promise){let Y=Z.then((_)=>{return I.set(D,{value:_,expiresAt:z}),_});return I.set(D,{value:Y,expiresAt:z}),Y}return I.set(D,{value:Z,expiresAt:z}),Z};return W.clear=()=>I.clear(),W.updateTtl=(M)=>{$=M;let D=Date.now(),f=D+M*1000;for(let[X,z]of I.entries())if(z.expiresAt>D)z.expiresAt=f,I.set(X,z)},W};var J=(H)=>{return H?.constructor===Object},B=(H)=>{return H===null||H===void 0||typeof H!=="object"&&typeof H!=="function"},R=(H)=>{return!H},U=(H)=>{return!!H},G=(H)=>{return H===null||H===void 0};var C=(H,$)=>{let I={...H};for(let W of Object.keys($)){let M=I[W],D=$[W];if(B(M)&&B(D)){I[W]=D;continue}if(Array.isArray(M)&&Array.isArray(D)){I[W]=M.concat(D);continue}if(J(M)&&J(D)){I[W]=C(M,D);continue}I[W]=D}return I},P=(H,$)=>{if(Array.isArray(H))return H.map((I)=>P(I,$));if(J(H))return Object.keys(H).reduce((W,M)=>{let D=$(M),f=H[M];return W[D]=P(f,$),W},{});return H},q=(H,$)=>{if(Array.isArray(H))return H.map((I,W)=>{if(J(I))return q(I,$);return $(I,W)});if(J(H))return Object.keys(H).reduce((W,M)=>{let D=H[M];if(J(D)||Array.isArray(D))W[M]=q(D,$);else W[M]=$(D,M);return W},{});return H};var x=(H="",$={})=>{let I=async(W,M={})=>{let D=new URL(H?`${H}${W}`:W),{params:f,parser:X,...z}=C($,M);if(J(f))Object.entries(f).forEach(([Y,_])=>{if(G(_))return;D.searchParams.append(Y,_.toString())});if(J(z.body))z.body=JSON.stringify(z.body),z.headers={...z.headers,"Content-Type":"application/json"};let Q=await fetch(D,z);if(!Q.ok){if(Q.headers.get("Content-Type")?.startsWith("application/json"))throw await Q.json();throw Error(Q.statusText)}return await(X?.(Q)??Q.json())};return{get:(W,M)=>I(W,{...M,method:"GET"}),post:(W,M,D)=>I(W,{...D,method:"POST",body:M}),put:(W,M,D)=>I(W,{...D,method:"PUT",body:M}),delete:(W,M)=>I(W,{...M,method:"DELETE"})}},h=async(H)=>{try{return[null,await H]}catch($){return[$,void 0]}};var k=(H,$)=>{return Math.floor(Math.random()*($-H+1))+H};var c=(H)=>{return H.replace(/_([a-zA-Z])/g,($,I)=>I.toUpperCase())},j=(H)=>{return H.replace(/([A-Z])/g,($,I)=>`_${I.toLowerCase()}`)},v=(H)=>{return H.charAt(0).toUpperCase()+H.slice(1)},y=(H)=>{return H.charAt(0).toLowerCase()+H.slice(1)},b=async(H)=>{if(!H.startsWith("http"))throw Error("\u56FE\u7247\u5730\u5740\u5FC5\u987B\u4EE5http\u6216https\u5F00\u5934");let $="",I=await x().get(H,{parser:(D)=>{return $=D.headers.get("Content-Type")||"image/jpeg",D.arrayBuffer()}}),M=Buffer.from(I).toString("base64");return`data:${$};base64,${M}`},p=(H="",$)=>{if(!H)return"";let{maxLength:I=1/0,disableNewLineReplace:W=!1,disableWhitespaceCollapse:M=!1,omission:D="..."}=$??{},f=H;if(!W)f=f.replace(/\r?\n/g,"\\n");else f=f.replace(/\r?\n/g," ");if(!M)f=f.replace(/\s+/g," ");if(f=f.trim(),I>0&&f.length>I)return f.slice(0,I)+D;return f};var o=async(H=150)=>{return new Promise(($)=>{setTimeout($,H)})};export{S as withCache,h as to,E as timeLog,c as snakeToCamel,o as sleep,k as randomInt,C as mergeObjects,q as mapValues,P as mapKeys,F as loopUntil,U as isTruthy,B as isPrimitive,J as isObject,G as isNil,R as isFalsy,b as imageUrlToBase64,x as fetcher,y as decapitalize,p as compactStr,v as capitalize,j as camelToSnake};
