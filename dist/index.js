// @bun
var T=(...H)=>{console.log(`${new Date().toLocaleTimeString()}`,...H)};var x=async(H,C)=>{let{maxRetries:D=5,shouldStop:z=()=>!0}=C??{};for(let W=0;W<D;W++){let $=await H(W);if(z($))return $}throw Error("\u8D85\u8FC7\u4E86\u6700\u5927\u5FAA\u73AF\u6B21\u6570\uFF08maxRetires\uFF09\u4E14\u672A\u6EE1\u8DB3\u505C\u6B62\u6267\u884C\u6761\u4EF6")};var A=(H,C=-1)=>{let D=new Map,z=(...W)=>{let $=JSON.stringify(W),I=Date.now(),X=D.get($);if(X&&I<X.expiresAt)return X.value;let J=C===-1?1/0:I+C*1000,Q={setTtl:(Y)=>{J=I+Y*1000}},Z=H.apply(Q,W);if(Z instanceof Promise){let Y=Z.then((_)=>{return D.set($,{value:_,expiresAt:J}),_});return D.set($,{value:Y,expiresAt:J}),Y}return D.set($,{value:Z,expiresAt:J}),Z};return z.clear=()=>D.clear(),z.updateTtl=(W)=>{C=W;let $=Date.now(),I=$+W*1000;for(let[X,J]of D.entries())if(J.expiresAt>$)J.expiresAt=I,D.set(X,J)},z};var M=(H)=>{return H?.constructor===Object},B=(H)=>{return H===null||H===void 0||typeof H!=="object"&&typeof H!=="function"},S=(H)=>{return!H},U=(H)=>{return!!H},P=(H)=>{return H===null||H===void 0};var G=(H,C)=>{let D={...H};for(let z of Object.keys(C)){let W=D[z],$=C[z];if(B(W)&&B($)){D[z]=$;continue}if(Array.isArray(W)&&Array.isArray($)){D[z]=W.concat($);continue}if(M(W)&&M($)){D[z]=G(W,$);continue}D[z]=$}return D},f=(H,C)=>{if(Array.isArray(H))return H.map((D)=>f(D,C));if(M(H))return Object.keys(H).reduce((z,W)=>{let $=C(W),I=H[W];return z[$]=f(I,C),z},{});return H},q=(H,C)=>{if(Array.isArray(H))return H.map((D,z)=>{if(M(D))return q(D,C);return C(D,z)});if(M(H))return Object.keys(H).reduce((z,W)=>{let $=H[W];if(M($)||Array.isArray($))z[W]=q($,C);else z[W]=C($,W);return z},{});return H};var E=(H="",C={})=>{let D=async(z,W={})=>{let $=new URL(H?`${H}${z}`:z),{params:I,parser:X,...J}=G(C,W);if(M(I))Object.entries(I).forEach(([Y,_])=>{if(P(_))return;$.searchParams.append(Y,_.toString())});if(M(J.body))J.body=JSON.stringify(J.body),J.headers={...J.headers,"Content-Type":"application/json"};let Q=await fetch($,J);if(!Q.ok){if(Q.headers.get("Content-Type")?.startsWith("application/json"))throw await Q.json();throw Error(Q.statusText)}return await(X?.(Q)??Q.json())};return{get:(z,W)=>D(z,{...W,method:"GET"}),post:(z,W,$)=>D(z,{...$,method:"POST",body:W}),put:(z,W,$)=>D(z,{...$,method:"PUT",body:W}),delete:(z,W)=>D(z,{...W,method:"DELETE"})}},m=async(H)=>{try{return[null,await H]}catch(C){return[C,void 0]}};var w=(H)=>{return H.replace(/_([a-zA-Z])/g,(C,D)=>D.toUpperCase())},d=(H)=>{return H.replace(/([A-Z])/g,(C,D)=>`_${D.toLowerCase()}`)},c=(H)=>{return H.charAt(0).toUpperCase()+H.slice(1)},j=(H)=>{return H.charAt(0).toLowerCase()+H.slice(1)},v=async(H)=>{if(!H.startsWith("http"))throw Error("\u56FE\u7247\u5730\u5740\u5FC5\u987B\u4EE5http\u6216https\u5F00\u5934");let C="",D=await E().get(H,{parser:($)=>{return C=$.headers.get("Content-Type")||"image/jpeg",$.arrayBuffer()}}),W=Buffer.from(D).toString("base64");return`data:${C};base64,${W}`},y=(H="",C)=>{if(!H)return"";let{maxLength:D=100,escapeNewlines:z=!0,collapseWhitespace:W=!0,omission:$="..."}=C??{},I=H;if(z)I=I.replace(/\r?\n/g,"\\n");else I=I.replace(/\r?\n/g," ");if(W)I=I.replace(/\s+/g," ");if(I=I.trim(),D>0&&I.length>D)return I.slice(0,D)+$;return I};var p=async(H=150)=>{return new Promise((C)=>{setTimeout(C,H)})};export{A as withCache,m as to,T as timeLog,w as snakeToCamel,p as sleep,G as mergeObjects,q as mapValues,f as mapKeys,x as loopUntil,U as isTruthy,B as isPrimitive,M as isObject,P as isNil,S as isFalsy,v as imageUrlToBase64,E as fetcher,j as decapitalize,y as compactStr,c as capitalize,d as camelToSnake};
