// @bun
var f=(...H)=>{console.log(`${new Date().toLocaleTimeString()}`,...H)};var F=async(H,$)=>{let{maxRetries:M=5,shouldStop:W=()=>!0}=$??{};for(let D=0;D<M;D++){let I=await H(D);if(W(I))return I}throw Error(`\u8D85\u8FC7\u4E86\u6700\u5927\u5FAA\u73AF\u6B21\u6570\uFF08${M}\uFF09\u4E14\u672A\u6EE1\u8DB3\u505C\u6B62\u6267\u884C\u6761\u4EF6`)};var L=(H,$=-1)=>{let M=new Map,W=(...D)=>{let I=JSON.stringify(D),z=Date.now(),Q=M.get(I);if(Q&&z<Q.expiresAt)return Q.value;let J=$===-1?1/0:z+$*1000,Y={setTtl:(Z)=>{J=z+Z*1000}},_=H.apply(Y,D);if(_ instanceof Promise){let Z=_.then((B)=>{return M.set(I,{value:B,expiresAt:J}),B});return M.set(I,{value:Z,expiresAt:J}),Z}return M.set(I,{value:_,expiresAt:J}),_};return W.clear=()=>M.clear(),W.updateTtl=(D)=>{$=D;let I=Date.now(),z=I+D*1000;for(let[Q,J]of M.entries())if(J.expiresAt>I)J.expiresAt=z,M.set(Q,J)},W};var X=(H)=>{return H?.constructor===Object},C=(H)=>{return H===null||H===void 0||typeof H!=="object"&&typeof H!=="function"},A=(H)=>{return!H},U=(H)=>{return!!H},P=(H)=>{return H===null||H===void 0};var G=(H,$)=>{let M={...H};for(let W of Object.keys($)){let D=M[W],I=$[W];if(C(D)&&C(I)){M[W]=I;continue}if(Array.isArray(D)&&Array.isArray(I)){M[W]=D.concat(I);continue}if(X(D)&&X(I)){M[W]=G(D,I);continue}M[W]=I}return M},q=(H,$)=>{if(Array.isArray(H))return H.map((M)=>q(M,$));if(X(H))return Object.keys(H).reduce((W,D)=>{let I=$(D),z=H[D];return W[I]=q(z,$),W},{});return H},E=(H,$,M)=>{let{filter:W}=M??{};if(Array.isArray(H)){let D=H.map((I,z)=>{if(X(I))return E(I,$,M);return $(I,z)});if(W)return D.filter((I,z)=>W(I,z));return D}if(X(H))return Object.keys(H).reduce((I,z)=>{let Q=H[z],J;if(X(Q)||Array.isArray(Q))J=E(Q,$,M);else J=$(Q,z);if(!W||W(J,z))I[z]=J;return I},{});return H};var T=(H="",$={})=>{let M=async(W,D={})=>{let I=new URL(H?`${H}${W}`:W),{params:z,parser:Q,...J}=G($,D);if(X(z))Object.entries(z).forEach(([Z,B])=>{if(P(B))return;I.searchParams.append(Z,B.toString())});if(X(J.body))J.body=JSON.stringify(J.body),J.headers={...J.headers,"Content-Type":"application/json"};let Y=await fetch(I,J);if(!Y.ok){if(Y.headers.get("Content-Type")?.startsWith("application/json"))throw await Y.json();throw Error(Y.statusText)}return await(Q?.(Y)??Y.json())};return{get:(W,D)=>M(W,{...D,method:"GET"}),post:(W,D,I)=>M(W,{...I,method:"POST",body:D}),put:(W,D,I)=>M(W,{...I,method:"PUT",body:D}),delete:(W,D)=>M(W,{...D,method:"DELETE"})}},m=async(H)=>{try{return[null,await H]}catch($){return[$,void 0]}};var k=(H,$)=>{return Math.floor(Math.random()*($-H+1))+H};var c=(H)=>{return H.replace(/_([a-zA-Z])/g,($,M)=>M.toUpperCase())},j=(H)=>{return H.replace(/([A-Z])/g,($,M)=>`_${M.toLowerCase()}`)},v=(H)=>{return H.charAt(0).toUpperCase()+H.slice(1)},y=(H)=>{return H.charAt(0).toLowerCase()+H.slice(1)},b=async(H)=>{if(!H.startsWith("http"))throw Error("\u56FE\u7247\u5730\u5740\u5FC5\u987B\u4EE5http\u6216https\u5F00\u5934");let $="",M=await T().get(H,{parser:(I)=>{return $=I.headers.get("Content-Type")||"image/jpeg",I.arrayBuffer()}}),D=Buffer.from(M).toString("base64");return`data:${$};base64,${D}`},p=(H="",$)=>{if(!H)return"";let{maxLength:M=1/0,disableNewLineReplace:W=!1,disableWhitespaceCollapse:D=!1,omission:I="..."}=$??{},z=H;if(!W)z=z.replace(/\r?\n/g,"\\n");else z=z.replace(/\r?\n/g," ");if(!D)z=z.replace(/\s+/g," ");if(z=z.trim(),M>0&&z.length>M)return z.slice(0,M)+I;return z};var u=async(H=150)=>{return new Promise(($)=>{setTimeout($,H)})};export{L as withCache,m as to,f as timeLog,c as snakeToCamel,u as sleep,k as randomInt,G as mergeObjects,E as mapValues,q as mapKeys,F as loopUntil,U as isTruthy,C as isPrimitive,X as isObject,P as isNil,A as isFalsy,b as imageUrlToBase64,T as fetcher,y as decapitalize,p as compactStr,v as capitalize,j as camelToSnake};
