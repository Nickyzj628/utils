// @bun
var h=(...C)=>{console.log(`${new Date().toLocaleTimeString()}`,...C)};var j=async(C,G)=>{let{maxRetries:z=5,shouldStop:D=()=>!0}=G??{};for(let H=0;H<z;H++){let E=await C(H);if(D(E))return E}throw Error(`\u8D85\u8FC7\u4E86\u6700\u5927\u5FAA\u73AF\u6B21\u6570\uFF08${z}\uFF09\u4E14\u672A\u6EE1\u8DB3\u505C\u6B62\u6267\u884C\u6761\u4EF6`)};var v=(C,G=-1)=>{let z=new Map,D=(...H)=>{let E=JSON.stringify(H),$=Date.now(),M=z.get(E);if(M&&$<M.expiresAt)return M.value;let J=G===-1?1/0:$+G*1000,T={setTtl:(Q)=>{J=$+Q*1000}},P=C.apply(T,H);if(P instanceof Promise){let Q=P.then((X)=>{return z.set(E,{value:X,expiresAt:J}),X});return z.set(E,{value:Q,expiresAt:J}),Q}return z.set(E,{value:P,expiresAt:J}),P};return D.clear=()=>z.clear(),D.updateTtl=(H)=>{G=H;let E=Date.now(),$=E+H*1000;for(let[M,J]of z.entries())if(J.expiresAt>E)J.expiresAt=$,z.set(M,J)},D};var W=(C)=>{return C?.constructor===Object},_=(C)=>{return C===null||C===void 0||typeof C!=="object"&&typeof C!=="function"},b=(C)=>{return!C},p=(C)=>{return!!C},F=(C)=>{return C===null||C===void 0};var x=(C,G)=>{let z={...C};for(let D of Object.keys(G)){let H=z[D],E=G[D];if(_(H)&&_(E)){z[D]=E;continue}if(Array.isArray(H)&&Array.isArray(E)){z[D]=H.concat(E);continue}if(W(H)&&W(E)){z[D]=x(H,E);continue}z[D]=E}return z},S=(C,G)=>{if(Array.isArray(C))return C.map((z)=>S(z,G));if(W(C))return Object.keys(C).reduce((D,H)=>{let E=G(H),$=C[H];return D[E]=S($,G),D},{});return C},q=(C,G,z)=>{let{filter:D}=z??{};if(Array.isArray(C)){let H=C.map((E,$)=>{if(W(E))return q(E,G,z);return G(E,$)});if(D)return H.filter((E,$)=>D(E,$));return H}if(W(C))return Object.keys(C).reduce((E,$)=>{let M=C[$],J;if(W(M)||Array.isArray(M))J=q(M,G,z);else J=G(M,$);if(!D||D(J,$))E[$]=J;return E},{});return C};var R=(C="",G={})=>{let z=async(D,H={})=>{let E=new URL(C?`${C}${D}`:D),{params:$,parser:M,...J}=x(G,H);if(W($))Object.entries($).forEach(([Q,X])=>{if(F(X))return;E.searchParams.append(Q,X.toString())});if(W(J.body))J.body=JSON.stringify(J.body),J.headers={...J.headers,"Content-Type":"application/json"};let T=await fetch(E,J);if(!T.ok){if(T.headers.get("Content-Type")?.startsWith("application/json"))throw await T.json();throw Error(T.statusText)}return await(M?.(T)??T.json())};return{get:(D,H)=>z(D,{...H,method:"GET"}),post:(D,H,E)=>z(D,{...E,method:"POST",body:H}),put:(D,H,E)=>z(D,{...E,method:"PUT",body:H}),delete:(D,H)=>z(D,{...H,method:"DELETE"})}};var Y=async(C)=>{try{return[null,await C]}catch(G){return[G,void 0]}};var U=async(C)=>{let[G,z]=await Y(fetch(C,{method:"HEAD",redirect:"manual"}));if(G)return C;return z.headers.get("location")||C};var Z=(C)=>{let G=new Uint8Array(C),z="";for(let D=0;D<G.byteLength;D++)z+=String.fromCharCode(G[D]);return btoa(z)},O=async()=>{try{let G=await Function("modulePath","return import(modulePath)")("sharp");return G.default||G}catch{return null}},L=async(C,G,z,D)=>{let H=Buffer.from(G),E=C(H);if(z==="image/jpeg")E=E.jpeg({quality:Math.round(D*100)});else if(z==="image/png"){let M=Math.round((1-D)*9);E=E.png({compressionLevel:M})}let $=await E.toBuffer();return`data:${z};base64,${$.toString("base64")}`},V=async(C,G={})=>{let{quality:z=0.92,compressor:D,fetcher:H=fetch}=G;if(!C.startsWith("http"))throw Error("\u56FE\u7247\u5730\u5740\u5FC5\u987B\u4EE5http\u6216https\u5F00\u5934");let E=await H(C);if(!E.ok)throw Error(`\u83B7\u53D6\u56FE\u7247\u5931\u8D25: ${E.statusText}`);let $=E.headers.get("Content-Type")||"image/jpeg",M=await E.arrayBuffer();if($!=="image/jpeg"&&$!=="image/png"){let P=Z(M);return`data:${$};base64,${P}`}if(D)return await D(M,$,z);if(typeof OffscreenCanvas<"u"){let P=null;try{let Q=new Blob([M],{type:$});P=await createImageBitmap(Q);let X=new OffscreenCanvas(P.width,P.height),I=X.getContext("2d");if(!I)throw Error("\u65E0\u6CD5\u83B7\u53D6 OffscreenCanvas context");I.drawImage(P,0,0),P.close(),P=null;let K=await(await X.convertToBlob({type:$,quality:z})).arrayBuffer(),A=Z(K);return`data:${$};base64,${A}`}catch{P?.close();let Q=Z(M);return`data:${$};base64,${Q}`}}let J=await O();if(J)try{return await L(J,M,$,z)}catch{let P=Z(M);return`data:${$};base64,${P}`}let T=Z(M);return`data:${$};base64,${T}`};var G1=(C,G)=>{return Math.floor(Math.random()*(G-C+1))+C};var B=(C)=>{return C.replace(/_([a-zA-Z])/g,(G,z)=>z.toUpperCase())},N=(C)=>{return C.replace(/([A-Z])/g,(G,z)=>`_${z.toLowerCase()}`)},k=(C)=>{return C.charAt(0).toUpperCase()+C.slice(1)},g=(C)=>{return C.charAt(0).toLowerCase()+C.slice(1)};var w=(C="",G)=>{if(!C)return"";let{maxLength:z=1/0,disableNewLineReplace:D=!1,disableWhitespaceCollapse:H=!1,omission:E="..."}=G??{},$=C;if(!D)$=$.replace(/\r?\n/g,"\\n");else $=$.replace(/\r?\n/g," ");if(!H)$=$.replace(/\s+/g," ");if($=$.trim(),z>0&&$.length>z)return $.slice(0,z)+E;return $};var T1=async(C=150)=>{return new Promise((G)=>{setTimeout(G,C)})},W1=(C,G=300)=>{let z=null;return(...D)=>{if(z)clearTimeout(z);z=setTimeout(()=>{C(...D)},G)}},X1=(C,G=300)=>{let z=null;return function(...D){if(!z)z=setTimeout(()=>{z=null,C.apply(this,D)},G)}};export{v as withCache,Y as to,h as timeLog,X1 as throttle,B as snakeToCamel,T1 as sleep,G1 as randomInt,x as mergeObjects,q as mapValues,S as mapKeys,j as loopUntil,p as isTruthy,_ as isPrimitive,W as isObject,F as isNil,b as isFalsy,V as imageUrlToBase64,U as getRealURL,R as fetcher,g as decapitalize,W1 as debounce,w as compactStr,k as capitalize,N as camelToSnake};
