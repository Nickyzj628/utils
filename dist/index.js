// @bun
var R=(x,Y)=>{let{time:T=!0,fileName:G=!0}=Y??{},M=[];if(T)M.push(`[${new Date().toLocaleTimeString()}]`);if(G){let{stack:E}=Error(),P=E?.split(`
`)[2]?.trim()?.match(/at\s+(.*):(\d+)/);if(P?.[1]){let Q=P[1].split(/[/\\]/).pop();M.push(`[${Q}:${P[2]}]`)}}if(Array.isArray(x))M.push(...x);else M.push(x);console.log(...M)};var N=async(x,Y)=>{let{maxRetries:T=5,shouldStop:G}=Y??{},M;for(let E=0;E<T;E++)if(M=await x(E),G?.(M)===!0)return M;if(!G)return M;throw Error(`\u8D85\u8FC7\u4E86\u6700\u5927\u5FAA\u73AF\u6B21\u6570\uFF08${T}\uFF09\u4E14\u672A\u6EE1\u8DB3\u505C\u6B62\u6267\u884C\u6761\u4EF6`)};var h=(x,Y=-1)=>{let T=new Map,G=(...M)=>{let E=JSON.stringify(M),J=Date.now(),P=T.get(E);if(P&&J<P.expiresAt)return P.value;let Q=Y===-1?1/0:J+Y*1000,$={setTtl:(_)=>{Q=J+_*1000}},X=x.apply($,M);if(X instanceof Promise){let _=X.then((z)=>{return T.set(E,{value:z,expiresAt:Q}),z});return T.set(E,{value:_,expiresAt:Q}),_}return T.set(E,{value:X,expiresAt:Q}),X};return G.clear=()=>T.clear(),G.updateTtl=(M)=>{Y=M;let E=Date.now(),J=E+M*1000;for(let[P,Q]of T.entries())if(Q.expiresAt>E)Q.expiresAt=J,T.set(P,Q)},G};var n=(x)=>{return!x};var I=(x)=>{return x===null||x===void 0};var Z=(x)=>{return x?.constructor===Object};var C=(x)=>{return x===null||x===void 0||typeof x!=="object"&&typeof x!=="function"};var F=(x,Y)=>{if(Array.isArray(x))return x.map((T)=>F(T,Y));if(Z(x))return Object.keys(x).reduce((G,M)=>{let E=Y(M),J=x[M];return G[E]=F(J,Y),G},{});return x};var d=(x,Y,T)=>{let{filter:G}=T??{};if(Array.isArray(x)){let M=x.map((E,J)=>{if(Z(E))return d(E,Y,T);return Y(E,J)});if(G)return M.filter((E,J)=>G(E,J));return M}if(Z(x))return Object.keys(x).reduce((E,J)=>{let P=x[J],Q;if(Z(P)||Array.isArray(P))Q=d(P,Y,T);else Q=Y(P,J);if(!G||G(Q,J))E[J]=Q;return E},{});return x};var H=(x,Y)=>{let T={...x};for(let G of Object.keys(Y)){let M=T[G],E=Y[G];if(C(M)&&C(E)){T[G]=E;continue}if(Array.isArray(M)&&Array.isArray(E)){T[G]=M.concat(E);continue}if(Z(M)&&Z(E)){T[G]=H(M,E);continue}T[G]=E}return T};var Px=(x="",Y={})=>{let T=async(G,M={})=>{let E=new URL(x?`${x}${G}`:G),{params:J,parser:P,...Q}=H(Y,M);if(Z(J))Object.entries(J).forEach(([_,z])=>{if(I(z))return;E.searchParams.append(_,z.toString())});if(Z(Q.body)||Array.isArray(Q.body))Q.body=JSON.stringify(Q.body),Q.headers={...Q.headers,"Content-Type":"application/json"};let $=await fetch(E,Q);if(!$.ok){if($.headers.get("Content-Type")?.startsWith("application/json"))throw await $.json();throw Error($.statusText)}return await(P?.($)??$.json())};return{get:(G,M)=>T(G,{...M,method:"GET"}),post:(G,M,E)=>T(G,{...E,method:"POST",body:M}),put:(G,M,E)=>T(G,{...E,method:"PUT",body:M}),delete:(G,M)=>T(G,{...M,method:"DELETE"})}};var q=async(x)=>{try{return[null,await x]}catch(Y){return[Y,void 0]}};var _x=async(x)=>{let[Y,T]=await q(fetch(x,{method:"HEAD",redirect:"manual"}));if(Y)return x;return T.headers.get("location")||x};var D=(x)=>{let Y=new Uint8Array(x),T="";for(let G=0;G<Y.byteLength;G++)T+=String.fromCharCode(Y[G]);return btoa(T)},f=async()=>{try{let Y=await Function("modulePath","return import(modulePath)")("sharp");return Y.default||Y}catch{return null}},A=async(x,Y,T,G)=>{let M=Buffer.from(Y),E=x(M);if(T==="image/jpeg")E=E.jpeg({quality:Math.round(G*100)});else if(T==="image/png"){let P=Math.round((1-G)*9);E=E.png({compressionLevel:P})}let J=await E.toBuffer();return`data:${T};base64,${J.toString("base64")}`},zx=async(x,Y={})=>{let{quality:T=0.92,compressor:G,fetcher:M=fetch}=Y;if(!x.startsWith("http"))throw Error("\u56FE\u7247\u5730\u5740\u5FC5\u987B\u4EE5http\u6216https\u5F00\u5934");let E=await M(x);if(!E.ok)throw Error(`\u83B7\u53D6\u56FE\u7247\u5931\u8D25: ${E.statusText}`);let J=E.headers.get("Content-Type")||"image/jpeg",P=await E.arrayBuffer();if(J!=="image/jpeg"&&J!=="image/png"){let X=D(P);return`data:${J};base64,${X}`}if(G)return await G(P,J,T);if(typeof OffscreenCanvas<"u"){let X=null;try{let _=new Blob([P],{type:J});X=await createImageBitmap(_);let z=new OffscreenCanvas(X.width,X.height),W=z.getContext("2d");if(!W)throw Error("\u65E0\u6CD5\u83B7\u53D6 OffscreenCanvas context");W.drawImage(X,0,0),X.close(),X=null;let S=await(await z.convertToBlob({type:J,quality:T})).arrayBuffer(),K=D(S);return`data:${J};base64,${K}`}catch{X?.close();let _=D(P);return`data:${J};base64,${_}`}}let Q=await f();if(Q)try{return await A(Q,P,J,T)}catch{let X=D(P);return`data:${J};base64,${X}`}let $=D(P);return`data:${J};base64,${$}`};var dx=(x,Y)=>{return Math.floor(Math.random()*(Y-x+1))+x};var fx=(x)=>{return x.replace(/_([a-zA-Z])/g,(Y,T)=>T.toUpperCase())},Ax=(x)=>{return x.replace(/([A-Z])/g,(Y,T)=>`_${T.toLowerCase()}`)},Ox=(x)=>{return x.charAt(0).toUpperCase()+x.slice(1)},Rx=(x)=>{return x.charAt(0).toLowerCase()+x.slice(1)};var Ux=(x="",Y)=>{if(!x)return"";let{maxLength:T=1/0,disableNewLineReplace:G=!1,disableWhitespaceCollapse:M=!1,omission:E="..."}=Y??{},J=x;if(!G)J=J.replace(/\r?\n/g,"\\n");else J=J.replace(/\r?\n/g," ");if(!M)J=J.replace(/\s+/g," ");if(J=J.trim(),T>0&&J.length>T)return J.slice(0,T)+E;return J};var kx=(x,Y=300)=>{let T=null;return(...G)=>{if(T)clearTimeout(T);T=setTimeout(()=>{x(...G)},Y)}};var gx=async(x=150)=>{return new Promise((Y)=>{setTimeout(Y,x)})};var jx=(x,Y=300)=>{let T=null;return function(...G){if(!T)T=setTimeout(()=>{T=null,x.apply(this,G)},Y)}};export{h as withCache,q as to,jx as throttle,fx as snakeToCamel,gx as sleep,dx as randomInt,H as mergeObjects,d as mapValues,F as mapKeys,N as loopUntil,R as log,C as isPrimitive,Z as isObject,I as isNil,n as isFalsy,zx as imageUrlToBase64,_x as getRealURL,Px as fetcher,Rx as decapitalize,kx as debounce,Ux as compactStr,Ox as capitalize,Ax as camelToSnake};
