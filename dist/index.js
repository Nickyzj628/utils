var P=(e,s)=>{let{time:t=!0,fileName:n=!0}=s??{},a=[];if(t&&a.push(`[${new Date().toLocaleTimeString()}]`),n){let{stack:r}=new Error,i=r?.split(`
`)[2]?.trim()?.match(/at\s+(.*):(\d+)/);if(i?.[1]){let p=i[1].split(/[/\\]/).pop();a.push(`[${p}:${i[2]}]`)}}Array.isArray(e)?a.push(...e):a.push(e),console.log(...a)};var v=async(e,s)=>{let{maxRetries:t=5,shouldStop:n}=s??{},a;for(let r=0;r<t;r++)if(a=await e(r),n?.(a)===!0)return a;if(!n)return a;throw new Error(`\u8D85\u8FC7\u4E86\u6700\u5927\u5FAA\u73AF\u6B21\u6570\uFF08${t}\uFF09\u4E14\u672A\u6EE1\u8DB3\u505C\u6B62\u6267\u884C\u6761\u4EF6`)};var L=(e,s=-1)=>{let t=new Map,n=(...a)=>{let r=JSON.stringify(a),o=Date.now(),i=t.get(r);if(i&&o<i.expiresAt)return i.value;let p=s===-1?1/0:o+s*1e3,f={setTtl:u=>{p=o+u*1e3}},c=e.apply(f,a);if(c instanceof Promise){let u=c.then(m=>(t.set(r,{value:m,expiresAt:p}),m));return t.set(r,{value:u,expiresAt:p}),u}return t.set(r,{value:c,expiresAt:p}),c};return n.clear=()=>t.clear(),n.updateTtl=a=>{s=a;let r=Date.now(),o=r+a*1e3;for(let[i,p]of t.entries())p.expiresAt>r&&(p.expiresAt=o,t.set(i,p))},n};var q=e=>!e;var g=e=>e==null;var l=e=>e?.constructor===Object;var d=e=>e==null||typeof e!="object"&&typeof e!="function";var h=(e,s)=>Array.isArray(e)?e.map(t=>h(t,s)):l(e)?Object.keys(e).reduce((n,a)=>{let r=s(a),o=e[a];return n[r]=h(o,s),n},{}):e;var b=(e,s,t)=>{let{filter:n}=t??{};if(Array.isArray(e)){let a=e.map((r,o)=>l(r)?b(r,s,t):s(r,o));return n?a.filter((r,o)=>n(r,o)):a}return l(e)?Object.keys(e).reduce((r,o)=>{let i=e[o],p;return l(i)||Array.isArray(i)?p=b(i,s,t):p=s(i,o),(!n||n(p,o))&&(r[o]=p),r},{}):e};var x=(e,s)=>{let t={...e};for(let n of Object.keys(s)){let a=t[n],r=s[n];if(d(a)&&d(r)){t[n]=r;continue}if(Array.isArray(a)&&Array.isArray(r)){t[n]=a.concat(r);continue}if(l(a)&&l(r)){t[n]=x(a,r);continue}t[n]=r}return t};var ce=(e="",s={})=>{let t=async(n,a={})=>{let r=new URL(e?`${e}${n}`:n),{params:o,parser:i,...p}=x(s,a);l(o)&&Object.entries(o).forEach(([u,m])=>{g(m)||r.searchParams.append(u,m.toString())}),(l(p.body)||Array.isArray(p.body))&&(p.body=JSON.stringify(p.body),p.headers={...p.headers,"Content-Type":"application/json"});let f=await fetch(r,p);if(!f.ok)throw f.headers.get("Content-Type")?.startsWith("application/json")?await f.json():new Error(f.statusText);return await(i?.(f)??f.json())};return{get:(n,a)=>t(n,{...a,method:"GET"}),post:(n,a,r)=>t(n,{...r,method:"POST",body:a}),put:(n,a,r)=>t(n,{...r,method:"PUT",body:a}),delete:(n,a)=>t(n,{...a,method:"DELETE"})}};var w=async e=>{try{return[null,await e]}catch(s){return[s,void 0]}};var me=async e=>{let[s,t]=await w(fetch(e,{method:"HEAD",redirect:"manual"}));return s?e:t.headers.get("location")||e};var y=e=>{let s=new Uint8Array(e),t="";for(let n=0;n<s.byteLength;n++)t+=String.fromCharCode(s[n]);return btoa(t)},A=async()=>{try{let s=await new Function("modulePath","return import(modulePath)")("sharp");return s.default||s}catch{return null}},$=async(e,s,t,n)=>{let a=Buffer.from(s),r=e(a);if(t==="image/jpeg")r=r.jpeg({quality:Math.round(n*100)});else if(t==="image/png"){let i=Math.round((1-n)*9);r=r.png({compressionLevel:i})}let o=await r.toBuffer();return`data:${t};base64,${o.toString("base64")}`},de=async(e,s={})=>{let{quality:t=.92,compressor:n,fetcher:a=fetch}=s;if(!e.startsWith("http"))throw new Error("\u56FE\u7247\u5730\u5740\u5FC5\u987B\u4EE5http\u6216https\u5F00\u5934");let r=await a(e);if(!r.ok)throw new Error(`\u83B7\u53D6\u56FE\u7247\u5931\u8D25: ${r.statusText}`);let o=r.headers.get("Content-Type")||"image/jpeg",i=await r.arrayBuffer();if(o!=="image/jpeg"&&o!=="image/png"){let c=y(i);return`data:${o};base64,${c}`}if(n)return await n(i,o,t);if(typeof OffscreenCanvas<"u"){let c=null;try{let u=new Blob([i],{type:o});c=await createImageBitmap(u);let m=new OffscreenCanvas(c.width,c.height),T=m.getContext("2d");if(!T)throw new Error("\u65E0\u6CD5\u83B7\u53D6 OffscreenCanvas context");T.drawImage(c,0,0),c.close(),c=null;let S=await(await m.convertToBlob({type:o,quality:t})).arrayBuffer(),R=y(S);return`data:${o};base64,${R}`}catch{c?.close();let u=y(i);return`data:${o};base64,${u}`}}let p=await A();if(p)try{return await $(p,i,o,t)}catch{let c=y(i);return`data:${o};base64,${c}`}let f=y(i);return`data:${o};base64,${f}`};var Se=(e,s)=>Math.floor(Math.random()*(s-e+1))+e;var Ce=e=>e.replace(/_([a-zA-Z])/g,(s,t)=>t.toUpperCase()),Pe=e=>e.replace(/([A-Z])/g,(s,t)=>`_${t.toLowerCase()}`),Oe=e=>e.charAt(0).toUpperCase()+e.slice(1),ke=e=>e.charAt(0).toLowerCase()+e.slice(1);var ve=(e="",s)=>{if(!e)return"";let{maxLength:t=1/0,disableNewLineReplace:n=!1,disableWhitespaceCollapse:a=!1,omission:r="..."}=s??{},o=e;return n?o=o.replace(/\r?\n/g," "):o=o.replace(/\r?\n/g,"\\n"),a||(o=o.replace(/\s+/g," ")),o=o.trim(),t>0&&o.length>t?o.slice(0,t)+r:o};var Me=(e,s=300)=>{let t=null;return(...n)=>{t&&clearTimeout(t),t=setTimeout(()=>{e(...n)},s)}};var je=async(e=150)=>new Promise(s=>{setTimeout(s,e)});var Fe=(e,s=300)=>{let t=null;return function(...n){t||(t=setTimeout(()=>{t=null,e.apply(this,n)},s))}};export{Pe as camelToSnake,Oe as capitalize,ve as compactStr,Me as debounce,ke as decapitalize,ce as fetcher,me as getRealURL,de as imageUrlToBase64,q as isFalsy,g as isNil,l as isObject,d as isPrimitive,P as log,v as loopUntil,h as mapKeys,b as mapValues,x as mergeObjects,Se as randomInt,je as sleep,Ce as snakeToCamel,Fe as throttle,w as to,L as withCache};
