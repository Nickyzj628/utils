// @bun
var A=(...I)=>{console.log(`${new Date().toLocaleTimeString()}`,...I)};var B=async(I,$)=>{let{maxRetries:M=5,shouldStop:W=()=>!0}=$??{};for(let z=0;z<M;z++){let H=await I(z);if(W(H))return H}throw Error(`\u8D85\u8FC7\u4E86\u6700\u5927\u5FAA\u73AF\u6B21\u6570\uFF08${M}\uFF09\u4E14\u672A\u6EE1\u8DB3\u505C\u6B62\u6267\u884C\u6761\u4EF6`)};var O=(I,$=-1)=>{let M=new Map,W=(...z)=>{let H=JSON.stringify(z),D=Date.now(),J=M.get(H);if(J&&D<J.expiresAt)return J.value;let G=$===-1?1/0:D+$*1000,Q={setTtl:(X)=>{G=D+X*1000}},_=I.apply(Q,z);if(_ instanceof Promise){let X=_.then((C)=>{return M.set(H,{value:C,expiresAt:G}),C});return M.set(H,{value:X,expiresAt:G}),X}return M.set(H,{value:_,expiresAt:G}),_};return W.clear=()=>M.clear(),W.updateTtl=(z)=>{$=z;let H=Date.now(),D=H+z*1000;for(let[J,G]of M.entries())if(G.expiresAt>H)G.expiresAt=D,M.set(J,G)},W};var Z=(I)=>{return I?.constructor===Object},P=(I)=>{return I===null||I===void 0||typeof I!=="object"&&typeof I!=="function"},V=(I)=>{return!I},N=(I)=>{return!!I},q=(I)=>{return I===null||I===void 0};var E=(I,$)=>{let M={...I};for(let W of Object.keys($)){let z=M[W],H=$[W];if(P(z)&&P(H)){M[W]=H;continue}if(Array.isArray(z)&&Array.isArray(H)){M[W]=z.concat(H);continue}if(Z(z)&&Z(H)){M[W]=E(z,H);continue}M[W]=H}return M},F=(I,$)=>{if(Array.isArray(I))return I.map((M)=>F(M,$));if(Z(I))return Object.keys(I).reduce((W,z)=>{let H=$(z),D=I[z];return W[H]=F(D,$),W},{});return I},T=(I,$,M)=>{let{filter:W}=M??{};if(Array.isArray(I)){let z=I.map((H,D)=>{if(Z(H))return T(H,$,M);return $(H,D)});if(W)return z.filter((H,D)=>W(H,D));return z}if(Z(I))return Object.keys(I).reduce((H,D)=>{let J=I[D],G;if(Z(J)||Array.isArray(J))G=T(J,$,M);else G=$(J,D);if(!W||W(G,D))H[D]=G;return H},{});return I};var d=(I="",$={})=>{let M=async(W,z={})=>{let H=new URL(I?`${I}${W}`:W),{params:D,parser:J,...G}=E($,z);if(Z(D))Object.entries(D).forEach(([X,C])=>{if(q(C))return;H.searchParams.append(X,C.toString())});if(Z(G.body))G.body=JSON.stringify(G.body),G.headers={...G.headers,"Content-Type":"application/json"};let Q=await fetch(H,G);if(!Q.ok){if(Q.headers.get("Content-Type")?.startsWith("application/json"))throw await Q.json();throw Error(Q.statusText)}return await(J?.(Q)??Q.json())};return{get:(W,z)=>M(W,{...z,method:"GET"}),post:(W,z,H)=>M(W,{...H,method:"POST",body:z}),put:(W,z,H)=>M(W,{...H,method:"PUT",body:z}),delete:(W,z)=>M(W,{...z,method:"DELETE"})}},K=async(I)=>{try{return[null,await I]}catch($){return[$,void 0]}},j=async(I)=>{let[$,M]=await K(fetch(I,{method:"HEAD",redirect:"manual"}));if($)return I;return M.headers.get("location")||I};var v=(I,$)=>{return Math.floor(Math.random()*($-I+1))+I};var b=(I)=>{return I.replace(/_([a-zA-Z])/g,($,M)=>M.toUpperCase())},y=(I)=>{return I.replace(/([A-Z])/g,($,M)=>`_${M.toLowerCase()}`)},p=(I)=>{return I.charAt(0).toUpperCase()+I.slice(1)},n=(I)=>{return I.charAt(0).toLowerCase()+I.slice(1)},Y=(I)=>{let $=new Uint8Array(I),M="";for(let W=0;W<$.byteLength;W++)M+=String.fromCharCode($[W]);return btoa(M)},u=async(I,$={})=>{let{quality:M=0.92,compressor:W}=$;if(!I.startsWith("http"))throw Error("\u56FE\u7247\u5730\u5740\u5FC5\u987B\u4EE5http\u6216https\u5F00\u5934");let z=await fetch(I);if(!z.ok)throw Error(`\u83B7\u53D6\u56FE\u7247\u5931\u8D25: ${z.statusText}`);let H=z.headers.get("Content-Type")||"image/jpeg",D=await z.arrayBuffer();if(H!=="image/jpeg"&&H!=="image/png"){let G=Y(D);return`data:${H};base64,${G}`}if(W)return await W(D,H,M);if(typeof OffscreenCanvas<"u"){let G=null;try{let Q=new Blob([D],{type:H});G=await createImageBitmap(Q);let _=new OffscreenCanvas(G.width,G.height),X=_.getContext("2d");if(!X)throw Error("\u65E0\u6CD5\u83B7\u53D6 canvas context");X.drawImage(G,0,0),G.close(),G=null;let x=await(await _.convertToBlob({type:H,quality:M})).arrayBuffer(),S=Y(x);return`data:${H};base64,${S}`}catch{G?.close();let Q=Y(D);return`data:${H};base64,${Q}`}}let J=Y(D);return`data:${H};base64,${J}`},o=(I="",$)=>{if(!I)return"";let{maxLength:M=1/0,disableNewLineReplace:W=!1,disableWhitespaceCollapse:z=!1,omission:H="..."}=$??{},D=I;if(!W)D=D.replace(/\r?\n/g,"\\n");else D=D.replace(/\r?\n/g," ");if(!z)D=D.replace(/\s+/g," ");if(D=D.trim(),M>0&&D.length>M)return D.slice(0,M)+H;return D};var i=async(I=150)=>{return new Promise(($)=>{setTimeout($,I)})},r=(I,$=300)=>{let M=null;return(...W)=>{if(M)clearTimeout(M);M=setTimeout(()=>{I(...W)},$)}},a=(I,$=300)=>{let M=null;return function(...W){if(!M)M=setTimeout(()=>{M=null,I.apply(this,W)},$)}};export{O as withCache,K as to,A as timeLog,a as throttle,b as snakeToCamel,i as sleep,v as randomInt,E as mergeObjects,T as mapValues,F as mapKeys,B as loopUntil,N as isTruthy,P as isPrimitive,Z as isObject,q as isNil,V as isFalsy,u as imageUrlToBase64,j as getRealURL,d as fetcher,n as decapitalize,r as debounce,o as compactStr,p as capitalize,y as camelToSnake};
